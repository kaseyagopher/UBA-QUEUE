generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model service {
  id          Int      @id @default(autoincrement())
  nomService  String   @db.VarChar(50)
  description String?

  utilisateurs utilisateur[]
  tickets      ticket[]
  guichets     guichet[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model guichet {
  id        Int    @id @default(autoincrement())
  lettre    String @db.Char(1)

  idService    Int
  service      service       @relation(fields: [idService], references: [id])

  idUtilisateur Int?
  utilisateur   utilisateur? @relation(fields: [idUtilisateur], references: [id])

  tickets ticket[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([lettre, idService])
  @@index([idService])
  @@index([idUtilisateur])
}

model client {
  id         Int      @id @default(autoincrement())
  nom        String   @db.VarChar(100)
  postnom    String   @db.VarChar(100)
  prenom     String   @db.VarChar(100)

  tickets ticket[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model utilisateur {
  id         Int      @id @default(autoincrement())
  nom        String   @db.VarChar(100)
  postnom    String   @db.VarChar(100)
  prenom     String   @db.VarChar(100)
  email      String   @unique @db.VarChar(255)
  motDePasse String   @db.VarChar(255)
  role       String   @db.VarChar(50)
  statut     String   @db.VarChar(50)

  idService Int?
  service   service? @relation(fields: [idService], references: [id])

  // Relation inverse obligatoire pour Prisma
  guichets guichet[]

  tickets ticket[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model ticket {
  id           Int      @id @default(autoincrement())
  numero       Int
  statut       String   @db.VarChar(50)
  heureArrivee DateTime
  heureAppel   DateTime?
  heureServi   DateTime?
  tempsAttente Int?
  tempsService Int?

  idService     Int?
  idClient      Int?
  idUtilisateur Int?
  idGuichet     Int?

  client      client?      @relation(fields: [idClient], references: [id])
  service     service?     @relation(fields: [idService], references: [id])
  utilisateur utilisateur? @relation(fields: [idUtilisateur], references: [id])
  guichet     guichet?     @relation(fields: [idGuichet], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([idClient])
  @@index([idService])
  @@index([idUtilisateur])
  @@index([idGuichet])
  @@index([statut])
  @@index([created_at])
}